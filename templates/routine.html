{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Routines - DevSphere</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #1a202c;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
        }
        .ds-container {
            max-width: 1200px;
        }
        .ds-heading {
            color: #f7fafc;
        }
        .ds-text-secondary {
            color: #a0aec0;
        }
        .ds-text-muted {
            color: #718096;
        }
        .ds-card {
            background-color: #2d3748;
            border-color: #4a5568;
        }
        .tab-button.active {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #4a5568;
        }
        th {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        tr:hover {
            background-color: #4a5568;
        }
        
    </style>
    <link rel="stylesheet" href="{% static 'css/components.css' %}" />
</head>
<body class="ds-body">
    <!-- TOAST MESSAGES -->
    {% include 'components/messages.html' %}

    <!-- NAVBAR -->
    {% include "components/navbar.html" %}

    <div class="ds-container mx-auto px-4 py-8">
        <h1 class="ds-heading text-4xl text-center mb-8">Your Routines</h1>

        {% if routine_data %}
            <div class="ds-card p-6 shadow-lg rounded-lg border border-gray-700">
                {% for data in routine_data %}
                    <h2 class="ds-heading text-2xl font-semibold mb-4">{{ data.routine.title }}</h2>
                    {% if data.routine.description %}
                        <p class="ds-text-secondary mb-4">{{ data.routine.description }}</p>
                    {% endif %}

                    <div class="flex flex-wrap md:flex-nowrap space-x-2 md:space-x-4 border-b-2 border-gray-600 mb-4 overflow-x-auto pb-2">
                        {% for daily_data in data.daily_data %}
                            <button class="tab-button flex-grow md:flex-none px-4 py-2 rounded-t-lg font-medium text-gray-400 hover:bg-gray-700 transition-colors duration-200 whitespace-nowrap" data-day="{{ daily_data.day }}">
                                {{ daily_data.day }}
                            </button>
                        {% endfor %}
                    </div>

                    {% for daily_data in data.daily_data %}
                        <div class="tab-content" data-day="{{ daily_data.day }}">
                            <h3 class="ds-heading text-xl font-semibold mb-4">{{ daily_data.day }}'s Routine</h3>
                            {% if daily_data.entries %}
                                <div class="overflow-x-auto">
                                <table class="min-w-full border border-gray-600 text-sm">
                                    <thead>
                                        <tr>
                                            <th class="px-4 py-2 border-b border-gray-600">Time</th>
                                            <th class="px-4 py-2 border-b border-gray-600">Class Type</th>
                                            <th class="px-4 py-2 border-b border-gray-600">Module Code</th>
                                            <th class="px-4 py-2 border-b border-gray-600">Subject</th>
                                            <th class="px-4 py-2 border-b border-gray-600">Sections</th>
                                            <th class="px-4 py-2 border-b border-gray-600">Teacher</th>
                                            <th class="px-4 py-2 border-b border-gray-600">Room</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {% for entry in daily_data.entries %}
                                        <tr>
                                            <td class="px-4 py-2 border-b border-gray-700">{{ entry.time_range }}</td>
                                            <td class="px-4 py-2 border-b border-gray-700">{{ entry.class_type }}</td>
                                            <td class="px-4 py-2 border-b border-gray-700">{{ entry.module_code }}</td>
                                            <td class="px-4 py-2 border-b border-gray-700">{{ entry.subject }}</td>
                                            <td class="px-4 py-2 border-b border-gray-700">
                                                {% for name in entry.section_names %}
                                                {{ name }}{% if not forloop.last %}, {% endif %}
                                                {% endfor %}
                                            </td>
                                            <td class="px-4 py-2 border-b border-gray-700">{{ entry.teacher }}</td>
                                            <td class="px-4 py-2 border-b border-gray-700">{{ entry.room }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                                </div>
                            {% else %}
                                <p class="ds-text-muted mt-2">NO ROUTINE FOR THIS DAY</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-12">
                <div class="ds-card p-6 shadow-lg rounded-lg border border-gray-700">
                    <p class="ds-text-muted text-lg">NO ROUTINE AVAILABLE</p>
                    <p class="ds-text-secondary text-sm mt-2">CHECK BACK LATER</p>
                </div>
            </div>
        {% endif %}
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const tabs = document.querySelectorAll(".tab-button");
            const contents = document.querySelectorAll(".tab-content");

            const showTab = (day) => {
                contents.forEach(content => {
                    content.style.display = 'none';
                });
                tabs.forEach(tab => {
                    tab.classList.remove('active');
                });
                const selectedTab = document.querySelector(`.tab-button[data-day="${day}"]`);
                const selectedContent = document.querySelector(`.tab-content[data-day="${day}"]`);
                if (selectedTab && selectedContent) {
                    selectedTab.classList.add('active');
                    selectedContent.style.display = 'block';
                }
            };
            
            const today = new Date();
            const daysOfWeek = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            const currentDay = daysOfWeek[today.getDay()];
            
            let initialDay = currentDay;
            if (!document.querySelector(`.tab-button[data-day="${currentDay}"]`)) {
                if (tabs.length > 0) {
                    initialDay = tabs[0].dataset.day;
                }
            }

            if (tabs.length > 0) {
                showTab(initialDay);
            }

            tabs.forEach(tab => {
                tab.addEventListener("click", () => {
                    const day = tab.dataset.day;
                    showTab(day);
                });
            });
        });
    </script>
</body>
</html>
